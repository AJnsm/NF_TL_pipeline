// params {
//     dataType     = "agnostic",
//     rawDataPath  = "/exports/igmm/eddie/ponting-lab/abel/10X_cells/NF_TL/LukeLiverData/fullCounts.csv",
//     clusterFile  = "/exports/igmm/eddie/ponting-lab/abel/10X_cells/NF_TL/LukeLiverData/clusters.csv",
//     userGenes    = "/exports/igmm/eddie/ponting-lab/abel/10X_cells/NF_TL/LukeLiverData/userGenes.csv",
//     doubletFile  = Null,
//     nGenes       = 4,
//     nCells       = 20,
//     clusterArray = [0, 1],
//     PCalpha      = 0.05,
//     bsResamps    = 2000,
//     twoReplicates = false,


//     maxQueueSize   = 25,

//     cores_makeData = 1,
//     cores_PC       = 4,
//     cores_MCMC     = 4,
//     cores_1pt      = 4,
//     cores_2pt      = 4,
//     cores_3pt      = 4,

//     mem_makeData   = "4G",
//     mem_PC         = "4G",
//     mem_MCMC       = "4G",
//     mem_1pt        = "4G",
//     mem_2pt        = "4G",
//     mem_3pt        = "4G",

//     time_makeData  = "1h",
//     time_PC        = "1h",
//     time_MCMC      = "1h",
//     time_1pt       = "1h",
//     time_2pt       = "1h",
//     time_3pt       = "1h"

// }


// params{
//     rawDataPath = "${launchDir}/cellData/ZeiselCells"
//     clusterFile = "${launchDir}/cellData/clusters.csv"
//     doubletFile = "${launchDir}/cellData/bcDoublets_1M.csv"
//     PCcores = 12
//     PCalpha = 0.05
//     coupCores = 12
//     nGenes = 500
//     nCells = 12000

// }


params{
    dataType = "agnostic",
    rawDataPath = "/exports/igmm/eddie/ponting-lab/abel/10X_cells/NF_TL/LukeLiverData/fullCounts.csv",
    clusterFile = "/exports/igmm/eddie/ponting-lab/abel/10X_cells/NF_TL/LukeLiverData/clusters.csv",
    userGenes = "/exports/igmm/eddie/ponting-lab/abel/10X_cells/NF_TL/LukeLiverData/userGenes.csv",
    doubletFile= " ",
    nGenes = 4,
    nCells = 20
}

process{
    clusterOptions = {"-l h_vmem=${task.memory.bytes/task.cpus}"}
    executor = 'sge'
    scratch = true

    beforeScript = """
    . /etc/profile.d/modules.sh
    module load roslin/singularity/3.5.3
    # workaround to make non-sandbox mode work, SGE sets this variable
    # to the root user runtime directory, causing permission issues
    unset XDG_RUNTIME_DIR
    export SINGULARITY_TMPDIR="\$TMPDIR"
    """


    withName: makeData { 
        executor = 'sge'
        cpus = 1
        memory = '96 GB'
        time = '10h'
    }

    withName: estimatePCgraph { 
        executor = 'sge'
        cpus = params.PCcores
        penv = "sharedmem"
        memory = '72 GB'
        time = '28h'
    }

    withName: iterMCMCscheme {
        executor = 'sge'
        cpus = 1
        memory = '8 GB'
        time = '28h'
    }

    withLabel: 'interactionEstimation' {
        executor = 'sge'
        cpus = params.coupCores
        penv = "sharedmem"
        memory = '96 GB'
    }

    withName: estimateCoups_1pts { 
        time = '10h'
    }

    withName: estimateCoups_2pts { 
        time = '48h'
    }

    withName: estimateCoups_3pts { 
        time = '48h'
    }
}

executor {
    queueSize = 30
}

includeConfig 'singularity.config'